# مكون التحقق من OTP المحسن

مكون تحقق من رمز OTP (One-Time Password) محسن ومتطور مبني باستخدام النموذج الديناميكي مع دعم كامل للغة العربية.

## المميزات

### ✅ المميزات الأساسية
- **إدخال OTP ذكي**: 4 أرقام مع تنقل تلقائي بين الحقول
- **عد تنازلي**: 5 دقائق مع إمكانية إعادة الإرسال
- **تحقق تلقائي**: عند إدخال جميع الأرقام
- **دعم النسخ واللصق**: لسهولة الإدخال على الأجهزة المحمولة
- **تحقق من الأخطاء**: رسائل خطأ واضحة باللغة العربية

### ✅ تحسينات تجربة المستخدم
- **رسائل نجاح وخطأ**: مع أيقونات وألوان مناسبة
- **عداد المحاولات**: عرض عدد المحاولات المتبقية
- **حالات التحميل**: مؤشرات تحميل أثناء العمليات
- **تصميم متجاوب**: يعمل على جميع أحجام الشاشات
- **دعم RTL**: تصميم مناسب للغة العربية

### ✅ الأمان والتحقق
- **حد أقصى للمحاولات**: 3 محاولات قبل الحظر
- **إعادة تعيين المحاولات**: عند إعادة إرسال الرمز
- **تحقق من صحة المدخلات**: فقط الأرقام مسموحة
- **حماية من الإرسال المتكرر**: منع الإرسال المتعدد

## الاستخدام

### 1. استيراد المكون

```typescript
import { OtpVerificationComponent } from './auth/otp/otp-verification.component';

@Component({
  imports: [OtpVerificationComponent],
  // ...
})
```

### 2. استخدام في القالب

```html
<app-otp-verification></app-otp-verification>
```

### 3. تخصيص الإعدادات

```typescript
export class MyComponent {
  // تخصيص رقم الهاتف
  phone: string = '+966555555555';
  
  // تخصيص عدد المحاولات
  maxAttempts: number = 3;
  
  // تخصيص مدة العد التنازلي
  countdownDuration: number = 5 * 60; // 5 دقائق
}
```

## التكوين

### خصائص المكون

| الخاصية | النوع | الافتراضي | الوصف |
|---------|-------|-----------|-------|
| `phone` | string | '+966555555555' | رقم الهاتف المرسل إليه الرمز |
| `maxAttempts` | number | 3 | الحد الأقصى لعدد المحاولات |
| `countdown` | number | 300 | مدة العد التنازلي بالثواني |

### حالات المكون

| الحالة | الوصف |
|--------|-------|
| `isLoading` | أثناء التحقق من الرمز |
| `isResending` | أثناء إعادة إرسال الرمز |
| `isError` | عند حدوث خطأ |
| `isVerified` | عند نجاح التحقق |
| `attempts` | عدد المحاولات المستخدمة |

## الرسائل

### رسائل النجاح
- `تم التحقق من حسابك بنجاح!`
- `تم إرسال رمز التحقق بنجاح`

### رسائل الخطأ
- `رمز التحقق غير صحيح. المحاولات المتبقية: X`
- `تم تجاوز الحد الأقصى للمحاولات، يرجى طلب رمز جديد`
- `فشل في إرسال رمز التحقق، يرجى المحاولة مرة أخرى`
- `حدث خطأ أثناء التحقق، يرجى المحاولة مرة أخرى`
- `يرجى إدخال رمز التحقق المكون من 4 أرقام`

## التخصيص

### تخصيص الألوان

```scss
// تخصيص ألوان النجاح
.success-message {
  background-color: #dcfce7;
  border-color: #22c55e;
  color: #166534;
}

// تخصيص ألوان الخطأ
.error-message {
  background-color: #fef2f2;
  border-color: #ef4444;
  color: #991b1b;
}
```

### تخصيص الأحجام

```scss
// تخصيص حجم حقول OTP
.otp-input {
  width: 3rem;
  height: 3rem;
  font-size: 1.25rem;
}

// تخصيص حجم الأزرار
.verify-button {
  padding: 1rem 2rem;
  font-size: 1rem;
}
```

## التكامل مع API

### دالة التحقق

```typescript
public async verifyOtp(otp: string): Promise<void> {
  try {
    // استدعاء API للتحقق
    const response = await this.authService.verifyOtp(otp);
    
    if (response.success) {
      this.isVerified = true;
      this.successMessage = 'تم التحقق من حسابك بنجاح!';
      // الانتقال للصفحة التالية
    } else {
      this.isError = true;
      this.errorMessage = 'رمز التحقق غير صحيح';
    }
  } catch (error) {
    this.isError = true;
    this.errorMessage = 'حدث خطأ أثناء التحقق';
  }
}
```

### دالة إعادة الإرسال

```typescript
public async resendOtp(): Promise<void> {
  try {
    // استدعاء API لإعادة الإرسال
    await this.authService.resendOtp(this.phone);
    
    this.successMessage = 'تم إرسال رمز التحقق بنجاح';
    this.attempts = 0; // إعادة تعيين المحاولات
  } catch (error) {
    this.errorMessage = 'فشل في إرسال رمز التحقق';
  }
}
```

## إمكانية الوصول

### دعم الشاشات القارئة
- تسميات ARIA مناسبة
- رسائل خطأ واضحة
- تنقل بالكيبورد

### دعم الأجهزة المحمولة
- أحجام أزرار مناسبة للمس
- دعم النسخ واللصق
- تصميم متجاوب

### دعم الوضع المظلم
```scss
@media (prefers-color-scheme: dark) {
  .otp-verification-container {
    background-color: #1f2937;
    color: #f9fafb;
  }
}
```

## الاختبار

### اختبار الوظائف الأساسية
```typescript
describe('OtpVerificationComponent', () => {
  it('should verify OTP correctly', () => {
    // اختبار التحقق الصحيح
  });
  
  it('should handle invalid OTP', () => {
    // اختبار الرمز غير الصحيح
  });
  
  it('should limit attempts', () => {
    // اختبار حد المحاولات
  });
});
```

## استكشاف الأخطاء

### مشاكل شائعة

1. **المكون لا يظهر**
   - تأكد من استيراد المكون في `imports`
   - تحقق من عدم وجود أخطاء في Console

2. **التحقق لا يعمل**
   - تأكد من تكوين API calls
   - تحقق من صحة الرمز المستخدم للاختبار (1234)

3. **العد التنازلي لا يعمل**
   - تأكد من إعداد `countdown` في التكوين
   - تحقق من عدم وجود أخطاء في RxJS

4. **رسائل الخطأ لا تظهر**
   - تأكد من تعيين `isError` و `errorMessage`
   - تحقق من CSS classes

### نصائح التطوير

- استخدم `console.log` لتتبع العمليات
- تحقق من حالة النموذج باستخدام `otpForm.valid`
- اختبر على أجهزة مختلفة للتأكد من التجاوب

## الترخيص

هذا المكون جزء من مشروع WAAI ويتبع نفس شروط الترخيص. 